<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ƒêang ch·∫°y t√°c v·ª•...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 1000px; margin: 2em auto; padding: 20px; background-color: #f9f9f9; }
        h1 { color: #333; }
        #log-container {
            width: 100%;
            height: 500px;
            background-color: #2b2b2b;
            color: #a9b7c6;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            box-sizing: border-box;
            overflow-y: scroll;
            white-space: pre-wrap;
        }
        .status { margin-top: 20px; font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>
    <h1>üìú Nh·∫≠t k√Ω ch·∫°y Real-time</h1>
    <p>Qu√° tr√¨nh ƒëang ƒë∆∞·ª£c th·ª±c thi tr√™n m√°y ch·ªß. Vui l√≤ng kh√¥ng ƒë√≥ng trang n√†y...</p>

    <div id="log-container"></div>
    <div id="status" class="status">Tr·∫°ng th√°i: ƒêang kh·ªüi t·∫°o...</div>

    <script>
        const logContainer = document.getElementById('log-container');
        const statusDiv = document.getElementById('status');
        
        // M·ªü k·∫øt n·ªëi SSE ƒë·∫øn m√°y ch·ªß
        const eventSource = new EventSource("/stream-logs");

        // L·∫Øng nghe c√°c tin nh·∫Øn ƒë∆∞·ª£c g·ª≠i t·ª´ m√°y ch·ªß
        eventSource.onmessage = function(event) {
            const data = event.data;

            // Ki·ªÉm tra t√≠n hi·ªáu k·∫øt th√∫c ƒë·∫∑c bi·ªát
            if (data === "---TASK_COMPLETE---") {
                eventSource.close(); // ƒê√≥ng k·∫øt n·ªëi
                statusDiv.textContent = "Tr·∫°ng th√°i: Ho√†n t·∫•t! ƒêang chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang k·∫øt qu·∫£...";
                statusDiv.style.color = "green";
                // T·ª± ƒë·ªông chuy·ªÉn ƒë·∫øn trang k·∫øt qu·∫£ sau 2 gi√¢y
                setTimeout(() => {
                    window.location.href = "/results";
                }, 2000);
            } else {
                // Th√™m d√≤ng log m·ªõi v√† t·ª± ƒë·ªông cu·ªôn xu·ªëng
                logContainer.innerHTML += data + '<br>';
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        };

        // X·ª≠ l√Ω khi c√≥ l·ªói k·∫øt n·ªëi
        eventSource.onerror = function(err) {
            statusDiv.textContent = "Tr·∫°ng th√°i: M·∫•t k·∫øt n·ªëi v·ªõi m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i.";
            statusDiv.style.color = "red";
            eventSource.close();
        };
    </script>
</body>
</html>