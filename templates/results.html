<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>K·∫øt qu·∫£ t√¨m ki·∫øm</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 1200px; margin: 2em auto; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px 12px; text-align: left; vertical-align: top; }
        th { background-color: #f8f8f8; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .status { font-style: italic; color: #555; font-size: 0.9em; }
        .email { font-weight: bold; color: #d9534f; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .actions { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;}
        button, .button-link { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; text-decoration: none; display: inline-block;}
        button:hover, .button-link:hover { opacity: 0.9; }
        .export-button { background-color: #17a2b8; }
        .back-link { display: inline-block; margin-top: 20px; font-weight: 500;}
    </style>
</head>
<body>
    <h1>K·∫øt qu·∫£ & L·∫•y Email</h1>
    <p>T√¨m th·∫•y <b>{{ businesses | length }}</b> ƒë·ªãa ƒëi·ªÉm. Tick ch·ªçn c√°c ƒë·ªãa ƒëi·ªÉm b·∫°n mu·ªën l·∫•y email.</p>
    
    <form action="/get-emails" method="post">
        <div class="actions">
            <button type="submit">üì• B·∫Øt ƒë·∫ßu l·∫•y email cho c√°c m·ª•c ƒë√£ ch·ªçn</button>
            <a href="/export" class="button-link export-button">üíæ Xu·∫•t ra Excel</a>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th style="width: 5%;"><input type="checkbox" onclick="toggle(this);" checked></th>
                    <th>T·ª´ kh√≥a</th><th>T√™n</th><th>ƒê·ªãa ch·ªâ</th><th>Trang web</th><th>Email</th><th>Tr·∫°ng th√°i</th>
                </tr>
            </thead>
            <tbody>
                {% for business in businesses %}
                <tr>
                    <td><input type="checkbox" name="selected_indices" value="{{ loop.index0 }}" checked></td>
                    <td>{{ business['T·ª´ kh√≥a'] }}</td>
                    <td>{{ business['T√™n'] }}</td>
                    <td>{{ business['ƒê·ªãa ch·ªâ'] }}</td>
                    <td><a href="{{ business['Trang web'] }}" target="_blank" rel="noopener noreferrer">{{ business['Trang web'] }}</a></td>
                    <td class="email">{{ business['Email'] }}</td>
                    <td class="status">{{ business['Tr·∫°ng th√°i'] }}</td>
                </tr>
                {% else %}
                <tr><td colspan="7" style="text-align: center;">Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm n√†o.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </form>


    <a href="/" class="back-link">‚Ü©Ô∏è Quay l·∫°i trang ch·ªß ƒë·ªÉ t√¨m ki·∫øm l·∫°i</a>

    <script>
        function toggle(source) {
            checkboxes = document.getElementsByName('selected_indices');
            for(var i=0, n=checkboxes.length; i<n; i++) {
                checkboxes[i].checked = source.checked;
            }
        }
    </script>
</body>
</html>